<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Flying Sites Map & IGC Tracker</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <!-- Leaflet.DistortableImage CSS -->
    <link rel="stylesheet" href="leaflet.distortableimage.css" />
    <!-- Leaflet.awesome-markers CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- MapLibre GL JS CSS -->
    <link href='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css' rel='stylesheet' />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">

 

</head>
<body>

    <!-- Global Time Controls -->
    <div id="global-time-controls">
        <label class="global-control-label">Forecast Day:</label>
        <div id="global-date-boxes"><span class="placeholder">Loading dates...</span></div>
        <label class="global-control-label">Hour (UK Time):</label>
        <div id="global-hour-boxes"><span class="placeholder">--</span></div>
        <button id="reset-time-filter" disabled>Reset to Earliest</button>
        <span id="global-time-status">Loading data...</span>
    </div>

    <!-- Wind Speed Filter Controls -->
    <div id="wind-speed-filter-controls">
         <input type="checkbox" id="enable-speed-filter"><label for="enable-speed-filter">Filter by Wind Speed (MPH) for selected day:</label>
         <label for="min-wind-speed">Min:</label><input type="number" id="min-wind-speed" value="5" min="0" max="50" step="1" disabled>
         <label for="max-wind-speed">Max:</label><input type="number" id="max-wind-speed" value="15" min="0" max="50" step="1" disabled>
         <span id="wind-speed-filter-status"></span>
    </div>

    <!-- Airspace/NOTAM/RASP Controls -->
    <div id="airspace-controls">
        <input type="checkbox" id="airspace-general-toggle"><label for="airspace-general-toggle" title="Show general airspace boundaries">Airspace</label>
        <input type="checkbox" id="airspace-notam-toggle" style="margin-left: 15px;"><label for="airspace-notam-toggle" title="Show active Notices to Airmen">NOTAMs</label>
        <span id="airspace-altitude-filter-control" style="margin-left: 15px; display: inline-flex; align-items: center; gap: 5px;">
            <label for="airspace-altitude-filter">Max Alt:</label>
            <input type="range" id="airspace-altitude-filter" min="0" max="20000" step="500" value="6000" style="width: 100px;">

            <span id="airspace-altitude-value" style="min-width: 60px; font-family: monospace; text-align: right;">6000 ft</span>
			
        </span>
        <input type="checkbox" id="enable-rasp-overlay" style="margin-left: 15px;"><label for="enable-rasp-overlay">RASP</label>
        <span id="rasp-opacity-control" style="display: none;">
             <label for="rasp-opacity-slider">Opacity:</label><input type="range" id="rasp-opacity-slider" min="0" max="100" value="25">
             <span id="rasp-opacity-value">25%</span>
        </span>
		<span style="margin-left: 15px; border-left: 1px solid #ccc; padding-left: 15px;">
             <input type="checkbox" id="open-meteo-indicator-toggle">
             <label for="open-meteo-indicator-toggle" title="Show Open-Meteo wind direction indicator on selected site marker">UK MET WIND</label>
        </span>
        <span id="rasp-overlay-status"></span>
    </div>

    <!-- RASP Corner Controls -->
    <div id="rasp-corner-controls" style="display: none;">
         <!-- ... RASP corner inputs and buttons ... -->
    </div>

    <!-- Loading Indicator -->
    <div id="loading-indicator">
        <span class="loader-text">Loading...<span class="dots-container"><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></span></span>
    </div>

    <!-- Map container -->
    <div id="map"></div>
	<!-- ****** ADD THIS NEW CONTAINER ****** -->
<div id="trackerMapOverlayInfo" class="map-overlay-info tracker-ui">
    <!-- Key info will be dynamically inserted here by displayKeyFlightInfo -->
</div>
<!-- ********************************** -->

    <!-- **** Tracker UI Containers **** -->
    <!-- Note: trackerHeaderCard is now MOVED inside chart-controls-container below -->

    <div id="trackerBottomPanel" class="tracker-ui">
         <!-- ****** THIS IS THE PARENT CONTAINER FOR SIDE-BY-SIDE LAYOUT ****** -->
         <div class="chart-controls-container card">

             <!-- **** trackerHeaderCard MOVED HERE **** -->
             <div id="trackerHeaderCard" class="card header-card tracker-ui">
                <div class="card-body">
                    <div class="controls-area">
                        <input type="file" id="trackerFileInput" accept=".igc" style="display: none;">
                        <button id="exitTrackerBtn" class="btn btn-outline-secondary btn-sm" style="margin-left: 0.5rem; display: none;" title="Exit Tracker">
                            <i class="fa-solid fa-right-from-bracket"></i> Exit Tracker
                        </button>

                        <div class="unit-selector"><label for="trackerAltitudeUnitSelect"><i class="fa-solid fa-mountain"></i></label><select id="trackerAltitudeUnitSelect" class="form-select-sm unit-select"><option value="m" selected>Meters (m)</option><option value="ft">Feet (ft)</option></select></div>
                        <div class="unit-selector"><label for="trackerSpeedUnitSelect"><i class="fa-solid fa-gauge-high"></i></label><select id="trackerSpeedUnitSelect" class="form-select-sm unit-select"><option value="km/h" selected>km/h</option><option value="mph">mph</option><option value="kts">kts</option></select></div>
                        <div class="unit-selector"><label for="trackerDistanceUnitSelect"><i class="fa-solid fa-route"></i></label><select id="trackerDistanceUnitSelect" class="form-select-sm unit-select"><option value="km" selected>Kilometers (km)</option><option value="mi">Miles (mi)</option></select></div>
                        <span id="trackerLoadingStatus" class="loading-status">Load IGC Track</span>

                    </div>
                    <hr>
                    <!-- **** Ensure this ID exists and matches main.js **** -->
                    <div id="trackerKeyFlightInfoGrid" class="row key-info-grid">
                        <p class="text-muted placeholder-key-info">Load track for key info.</p>
                    </div>
                </div>
             </div>
             <!-- **** END MOVED trackerHeaderCard **** -->

             <!-- **** barogram-container is the SECOND item for side-by-side **** -->
             <div class="barogram-container">
                <!-- **** Ensure this ID exists and matches main.js **** -->
                <canvas id="trackerBarogramCanvas"></canvas>
             </div>

         </div>
         <!-- ****** END OF chart-controls-container ****** -->

         <!-- Controls Footer remains below the side-by-side elements -->
         <div class="controls-footer">
             <div class="info-display" id="trackerInfoDisplay">--|--|--</div>
             <div class="slider-container"><input type="range" id="trackerTimeSlider" min="0" max="100" value="0" style="width: 100%;"></div> <!-- Added width: 100% inline based on previous request -->
             <div class="playback-controls">
                  <button id="trackerStepBackBtn" class="btn btn-light btn-sm"><i class="fa-solid fa-backward-step"></i></button>
                  <button id="trackerPlayPauseBtn" class="btn btn-primary btn-sm"><i class="fa-solid fa-play"></i></button>
                  <button id="trackerStepFwdBtn" class="btn btn-light btn-sm"><i class="fa-solid fa-forward-step"></i></button>
                  <div class="speed-control"><label for="trackerSpeedSelect" class="form-label-sm"><i class="fa-solid fa-gauge-high"></i></label><select id="trackerSpeedSelect" class="form-select-sm"><option value="1" selected>1x</option><option value="2">2x</option><option value="4">4x</option><option value="8">8x</option><option value="16">16x</option><option value="32">32x</option><option value="64">64x</option></select></div>
                  <div class="auto-pan-control"><input type="checkbox" id="trackerAutoPanCheckbox" checked><label for="trackerAutoPanCheckbox" title="Center map on glider"><i class="fa-solid fa-crosshairs"></i></label></div>
             </div>
         </div>
    </div>

    <div id="trackerLiveStatsBar" class="live-stats-bar card tracker-ui">
          <div class="live-stat-item"><span class="live-stat-icon"><i class="fa-solid fa-gauge-high"></i></span><span class="live-stat-value" id="trackerLiveSpeed">--</span><span class="live-stat-label">Speed</span></div>
           <div class="live-stat-item"><span class="live-stat-icon"><i class="fa-solid fa-mountain"></i></span><span class="live-stat-value" id="trackerLiveAltitude">--</span><span class="live-stat-label">Altitude</span></div>
           <div class="live-stat-item"><span class="live-stat-icon"><i class="fa-solid fa-arrows-up-down"></i></span><span class="live-stat-value" id="trackerLiveVario">--</span><span class="live-stat-label">Vario</span></div>
           <div class="live-stat-item"><span class="live-stat-icon"><i class="fa-regular fa-clock"></i></span><span class="live-stat-value" id="trackerLiveFlightTime">--:--</span><span class="live-stat-label">Elapsed</span></div>
     </div>

    <div id="trackerStatsPanel" class="card stats-card tracker-ui"> <!-- Container -->
        <div class="card-body">
             <!-- Add ID and icon to the title -->
             <h5 id="stats-panel-toggle" class="card-title stats-panel-toggle"> <!-- Toggle Area -->
                 <span><i class="fa-solid fa-list-check"></i> Track Stats</span>
                 <i class="fa-solid fa-chevron-down stats-panel-chevron"></i> <!-- Chevron Icon -->
             </h5>
             <!-- Content Area -->
             <div id="trackerStatsContent" class="stats-panel-content">
                 <p class="text-muted">Load track for stats.</p>
             </div>
        </div>
    </div>
    <!-- **** END Tracker UI Containers **** -->

    <!-- Site Hourly Forecast Calendar Container -->
<div id="site-forecast-calendar" style="display: none;">
   <div class="calendar-header">
       <span id="calendar-site-name">Site Name</span> <!-- REQUIRED -->
       <span id="calendar-date">Date</span>           <!-- REQUIRED -->
       <button id="calendar-close-button" title="Close Calendar"> <!-- REQUIRED -->
           <i class="fas fa-times"></i>
       </button>
   </div>
   <div id="calendar-content"> <!-- REQUIRED -->
       <!-- Hourly forecast boxes will be added here by JavaScript -->
       <div class="calendar-message">Loading forecast...</div> <!-- Optional initial message -->
   </div>
</div>

    <!-- External Libraries -->
	
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="./leaflet.distortableimage.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.min.js" defer></script>
    <script src="./wind-particles.js" defer></script>
    <script src='https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.js' defer></script>
    <script src="./leaflet-maplibre-gl.js" defer></script>
    <script src="./openairspace.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
	 <!-- **** ADD CHART.JS LIBRARY HERE **** -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    <!-- *********************************** -->

    <!-- Main Application Logic (Modules) -->
    <script type="module" src="./config.js"></script>
    <script type="module" src="./state.js"></script>
    <script type="module" src="./utils.js"></script>
    <script type="module" src="./particleControls.js"></script>
    <script type="module" src="./mapService.js"></script>
    <script type="module" src="./dataService.js"></script>
    <script type="module" src="./raspService.js"></script>
    <script type="module" src="./raspControls.js"></script>
    <script type="module" src="./timeControls.js"></script>
    <script type="module" src="./windFilter.js"></script>
    <script type="module" src="./starFilterControl.js"></script>
    <script type="module" src="./calendar.js"></script>
    <script type="module" src="./markerManager.js"></script>
    <script type="module" src="./particleService.js"></script>
    <script type="module" src="./airspaceService.js"></script>
    <script type="module" src="./airspaceControls.js"></script>
    <script type="module" src="./searchControl.js"></script>

    <!-- Tracker Modules -->
    <script type="module" src="Tracker/js/formatters.js"></script>
    <script type="module" src="Tracker/js/flightStats.js"></script>
    <script type="module" src="Tracker/js/interpolation.js"></script>
    <script type="module" src="Tracker/js/igcParser.js"></script>
    <script type="module" src="Tracker/js/display.js"></script>
    <script type="module" src="Tracker/js/playback.js"></script>
    <script type="module" src="Tracker/js/ui.js"></script>
    <script type="module" src="Tracker/trackerApp.js"></script> <!-- Correct path -->

    <!-- Main must be last -->
    <script type="module" src="./main.js"></script>

<!-- Code injected by live-server -->
<script> /* ... Live Server code ... */ </script>
</body>
</html>